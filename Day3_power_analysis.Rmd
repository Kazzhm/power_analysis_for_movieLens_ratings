---
title: "Power Analysis for MovieLens Ratings"
author: "LIU RUIHAN"
date: "2025-12-17"
output:
   pdf_document:
    latex_engine: xelatex
---

\newpage

## Resources
**Dataset downloaded from**: [https://grouplens.org/datasets/movielens/latest/](https://grouplens.org/datasets/movielens/latest/)

**Github repository**: [https://github.com/Kazzhm/power_analysis_for_movieLens_ratings/](https://github.com/Kazzhm/power_analysis_for_movieLens_ratings/)

\newpage

## 1. Dataset description

```{r setup, echo=FALSE, message=FALSE, warning=FALSE}

# setup
options(width=120)
knitr::opts_chunk$set(error = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)
library(lubridate)
library(pwr)
library(effsize)

# read data
ratings <- read.csv("ratings.csv", stringsAsFactors = FALSE)

# quick dataset summary for the slides
n_total <- nrow(ratings)
vars <- names(ratings)
users <- length(unique(ratings$userId))
movies <- length(unique(ratings$movieId))

cat(paste0("Dataset: ratings.csv\nRecords: ", n_total, " rows\nVariables: ", paste(vars, collapse=", "), "\nUnique users: ", users, "\nUnique movies: ", movies))
```

The dataset `ratings.csv` contains columns typically: `userId`, `movieId`, `rating`, `timestamp`. Ratings are on a 0.5–5.0 scale.

\newpage
 
## 2. Exploratory data analysis (EDA)

```{r eda, echo=TRUE}
# basic numeric summaries
summary_stats <- ratings %>%
  summarise(n = n(),
            mean_rating = mean(rating),
            sd_rating = sd(rating),
            min_rating = min(rating),
            max_rating = max(rating))
summary_stats

# Ratings distribution
ratings %>%
  ggplot(aes(rating)) +
  geom_histogram(binwidth=0.5) +
  labs(title = "Distribution of Ratings", x = "Rating", y = "Count")
```

Report central tendency (mean, SD), range, and distribution shape (skewness if present). These are necessary reporting items for power analysis since the standard deviation drives effect size computations.

\newpage

## 3. Framing the power analysis question

Possible study questions that fit this dataset:

1. One-sample test: Is the mean rating for the dataset different from a benchmark (e.g., 3.5)?
2. Two-sample test: Is there a difference in mean ratings between two time periods (early vs late) or between two groups of movies/users?

For this analysis we will do both:
- **One-sample t-test power** to detect difference from benchmark = 3.5
- **Two-sample t-test power** comparing early vs late ratings split by median timestamp

Both use the same continuous outcome (rating) and allow direct use of classical t-test power formulas.

\newpage

## 4. Prepare groups (early vs late)

```{r groups, echo=TRUE}
if("timestamp" %in% names(ratings)){
  ratings <- ratings %>% mutate(ts = as.numeric(timestamp))
  median_ts <- median(ratings$ts, na.rm = TRUE)
  ratings <- ratings %>% mutate(period = ifelse(ts < median_ts, "early", "late"))
} else {
  set.seed(2025)
  ratings <- ratings %>% mutate(period = sample(c("early", "late"), size = n(), replace = TRUE))
}

ratings %>% group_by(period) %>% summarise(n = n(), mean = mean(rating), sd = sd(rating))
```

\newpage

## 5. Observed effect size (Cohen's d)

```{r effectsize, echo=TRUE}
group_summary <- ratings %>% group_by(period) %>% summarise(n = n(), mean = mean(rating), 
                                                            sd = sd(rating))
means <- group_summary$mean
sds <- group_summary$sd
ns <- group_summary$n

# pooled sd
s_pooled <- sqrt(((ns[1]-1)*sds[1]^2 + (ns[2]-1)*sds[2]^2) / (ns[1]+ns[2]-2))
cohen_d_obs <- (means[1] - means[2]) / s_pooled

list(pooled_sd = s_pooled, cohen_d = cohen_d_obs)
```

\newpage

## 6. Power calculation: two-sample t-test (early vs late)

```{r power_two_sample, echo=TRUE}
# observed two-sample effect (use cohen_d_obs from earlier)
d_obs_two <- abs(cohen_d_obs)

# post-hoc power with current group sizes
n1 <- ns[1]; n2 <- ns[2]
posthoc_two <- pwr.t.test(n = min(n1, n2), d = d_obs_two, sig.level = 0.05, type = "two.sample", 
                          alternative = "two.sided")

# required n per group for small/medium/large d
req_two_small <- pwr.t.test(n = NULL, d = 0.2, sig.level = 0.05, power = 0.8, type = "two.sample")$n
req_two_med <- pwr.t.test(n = NULL, d = 0.5, sig.level = 0.05, power = 0.8, type = "two.sample")$n
req_two_large <- pwr.t.test(n = NULL, d = 0.8, sig.level = 0.05, power = 0.8, type = "two.sample")$n

list(d_obs_two = d_obs_two, n1 = n1, n2 = n2, posthoc_power_two = posthoc_two$power,
     req_two_small = req_two_small, req_two_med = req_two_med, req_two_large = req_two_large)
```

\newpage

## 7. Reporting items and how they were applied

For power analysis, typical reporting items include:

1. **Research question / hypothesis** — stated explicitly (e.g., difference between early/late periods).
2. **Statistical test** — one-sample t-test or two-sample t-test (state one- or two-tailed).
3. **Effect size** — definition and computed value (Cohen's d), formula documented.
4. **Alpha level** — 0.05 (two-sided) used throughout, explain rationale.
5. **Power** — target (commonly 0.8) and achieved (post-hoc) power reported.
6. **Sample size** — observed n and required n calculations for specified effect sizes.
7. **Assumptions** — normality, independence, equal variances; diagnostics and remedies (e.g., Welch) described.
8. **Data preprocessing** — handling of timestamps, NA values, filtering.
9. **Software and code availability** — R version and packages; GitHub link.
10. **Limitations** — observational data, multiple testing cautions, representativeness.


\newpage

## 8. Results summary

- Global mean rating: `r round(mean(ratings$rating), 3)` (SD = `r round(sd(ratings$rating), 3)`).
- Two-sample (early vs late): observed Cohen's d = `r round(d_obs_two, 3)`, post-hoc power = `r round(posthoc_two$power, 3)`.

\newpage

## 9. Limitations & further work

- MovieLens is observational: effects may be confounded by movie popularity, user behavior, or selection bias.
- Missing covariates (e.g., genre, user demographics) limit the scope of causal claims. It's necessary to consider ANCOVA or mixed-effects models when covariates are available.
- For multivariate/panel choices, it's necessary to consider multilevel power analysis.
